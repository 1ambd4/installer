<Project>

  <PropertyGroup>
    <UnifiedBuildValidationTestsDir>$([MSBuild]::NormalizeDirectory('$(RepoRoot)', 'test', 'Microsoft.DotNet.UnifiedBuild.Tests'))</UnifiedBuildValidationTestsDir>
    <UnifiedBuildValidationTestsProject>$([MSBuild]::NormalizeDirectory('$(UnifiedBuildValidationTestsDir)', 'Microsoft.DotNet.UnifiedBuild.Tests'))</UnifiedBuildValidationTestsProject>
  </PropertyGroup>

  <Target Name="RunUnifiedBuildValidation"
          AfterTargets="Build"
          DependsOnTargets="DetermineSourceBuiltSdkVersion">

    <PropertyGroup>
      <SdkTarballPath>%(SdkTarballItem.Identity)</SdkTarballPath>
    </PropertyGroup>

    <Exec Command="$(DotnetTool) test $(UnifiedBuildValidationTestsDir) --logger:trx -c $(Configuration) -p:VSTestUseMSBuildOutput=false"
          IgnoreStandardErrorWarningFormat="true"
          EnvironmentVariables="
            UNIFIED_BUILD_VALIDATION_SDK_TARBALL_PATH=$(SdkTarballItem);
            UNIFIED_BUILD_VALIDATION_TARGET_RID=$(TargetRid);
            UNIFIED_BUILD_VALIDATION_PORTABLE_RID=$(PortableRid);
            UNIFIED_BUILD_VALIDATION_BUILD_VERSION=$(SdkTarballPath);
            $(CustomTestEnvVars)" />

  </Target>

</Project>
