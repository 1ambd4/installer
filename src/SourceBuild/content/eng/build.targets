<Project>
  <UsingTask AssemblyFile="$(SdkArchiveDiffTasksAssembly)" TaskName="FindArchiveDiffs" />
  <UsingTask AssemblyFile="$(SdkArchiveDiffTasksAssembly)" TaskName="GetClosestOfficialSdk" />

  <Target Name="ReportSdkArchiveDiffs"
          AfterTargets="Build"
          DependsOnTargets="DetermineSourceBuiltSdkVersion" >

      <Message Text="No SDK archive to compare against." Importance="High" Condition="'@(SdkTarballItem)' == ''" />
      <GetClosestOfficialSdk BuiltSdkPath="@(SdkTarballItem)" Condition="'@(SdkTarballItem)' != ''">
        <Output TaskParameter="ClosestOfficialSdkPath" PropertyName="ClosestOfficialSdkPath" />
      </GetClosestOfficialSdk>

      <Message Text="Failed to find closest official SDK archive." Importance="High" Condition="'@(SdkTarballItem)' != '' AND '$(ClosestOfficialSdkPath)' == ''" />
      <FindArchiveDiffs BaselineArchive="@(SdkTarballItem)" TestArchive="$(ClosestOfficialSdkPath)" Condition="'@(SdkTarballItem)' != '' AND '$(ClosestOfficialSdkPath)' != ''">
        <Output TaskParameter="ContentDifferences" ItemName="ContentDifferences" />
      </FindArchiveDiffs>

      <Message Text="Difference in sdk archive: %(ContentDifferences.Kind): %(ContentDifferences.Identity)" Importance="High" Condition="'%(ContentDifferences.Kind)' != 'Unchanged'"/>
      <Delete Files="$(ClosestOfficialSdkPath)" Condition="'$(ClosestOfficialSdkPath)' == ''"/>

  </Target>

</Project>
